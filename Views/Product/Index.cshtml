@model IEnumerable<MvcBitirmeProjesi.Models.Product>

@{
    ViewData["Title"] = "Ürünler";
    var currentSortDirection = ViewBag.SortDirection as string ?? "ASC";
    var currentSortColumn = ViewBag.SortColumn as string ?? "";
    var searchQuery = ViewBag.SearchQuery as string ?? "";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">Ürün Listesi</h2>
        <a href="#" class="btn btn-success">Yeni Ürün Ekle</a>
    </div>

    <form method="get" class="mb-3">
        <div class="input-group">
            <input type="text" name="searchQuery" class="form-control" placeholder="Ürün ara..." value="@searchQuery" />
            <input type="hidden" name="sortColumn" value="@currentSortColumn" />
            <input type="hidden" name="sortDirection" value="@currentSortDirection" />
            <button type="submit" class="btn btn-primary">Ara</button>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Adı</th>
                    <th>Birim</th>
                    <th>Açıklama</th>
                    <th>QR</th>
                    <th>İşlemler</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    foreach (var product in Model)
                    {
                        <tr>
                            <td>@product.Id</td>
                            <td>@product.Name</td>
                            <td>@product.Unit</td>
                            <td>@product.Description</td>
                            <td>
                                <img src="@ViewBag.ProductQRCodes[product.Id]"
                                     alt="QR"
                                     style="width:40px; height:40px; cursor:pointer;"
                                     data-bs-toggle="modal"
                                     data-bs-target="#qrModal"
                                     onclick="openQrModal('@ViewBag.ProductQRCodes[product.Id]')" />
                            </td>
                            <td>
                                <div class="btn-group">
                                    <a href="#" class="btn btn-sm btn-warning">Düzenle</a>
                                    <a href="#" class="btn btn-sm btn-danger ms-1">Sil</a>
                                </div>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="text-center">Hiç ürün bulunamadı.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- QR Modal -->
<div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="qrModalLabel">QR Kodu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>
      <div class="modal-body text-center">
        <img id="qrModalImage" src="" alt="QR Kodu" class="img-fluid" />
      </div>
    </div>
  </div>
</div>

<script>
    function openQrModal(qrSrc) {
        const img = document.getElementById("qrModalImage");
        img.src = qrSrc;
    }
</script>