// ğŸ“Œ Models/News.cs - Haberler Modeli (VeritabanÄ± tablosu)
// ğŸ“Œ Bu sÄ±nÄ±f, haberleri saklamak iÃ§in kullanÄ±lÄ±r. Haber ID, baÅŸlÄ±k, iÃ§erik ve yayÄ±nlanma tarihi iÃ§erir.
public class News
{
    public int Id { get; set; } // âœ… Haber ID (Primary Key)
    public string Title { get; set; } // âœ… Haber BaÅŸlÄ±ÄŸÄ±
    public string Content { get; set; } // âœ… Haber Ä°Ã§eriÄŸi
    public DateTime PublishedDate { get; set; } // âœ… YayÄ±nlanma Tarihi
}

// ğŸ“Œ Data/ApplicationDbContext.cs - VeritabanÄ± baÄŸlantÄ±sÄ±
// ğŸ“Œ Haberler tablosunu veritabanÄ±na eklemek iÃ§in DbSet kullanÄ±lÄ±r.
public DbSet<News> News { get; set; }

// ğŸ“Œ Controllers/HomeController.cs - Ana sayfada haberleri gÃ¶stermek iÃ§in Controller
// ğŸ“Œ En gÃ¼ncel haberler sÄ±ralanarak ViewBag ile sayfaya gÃ¶nderilir.
public IActionResult Index()
{
    var newsList = _context.News
        .OrderByDescending(n => n.PublishedDate) // âœ… En gÃ¼ncel haberleri Ã¶nce getir
        .Take(5) // âœ… Sadece 5 haber gÃ¶ster
        .ToList();

    ViewBag.NewsList = newsList; // âœ… Haberleri View'e gÃ¶nder
    return View();
}

// ğŸ“Œ Views/Home/Index.cshtml - Ana sayfada haberleri listeleme
<!-- ğŸ“Œ Ana sayfada en son haberleri listeleyen HTML kodu. -->
<!-- ğŸ“Œ Haberlerin baÅŸlÄ±ÄŸÄ±, iÃ§eriÄŸi ve yayÄ±nlanma tarihi gÃ¶sterilir. -->
<h2 class="mb-4">Son Haberler</h2>

@if (ViewBag.NewsList != null && ViewBag.NewsList.Count > 0)
{
    <ul class="list-group">
        @foreach (var news in ViewBag.NewsList)
        {
            <li class="list-group-item">
                <h4>@news.Title</h4>
                <p>@news.Content</p>
                <small class="text-muted">@news.PublishedDate.ToString("dd.MM.yyyy HH:mm")</small>
            </li>
        }
    </ul>
}
else
{
    <p class="text-center text-muted">HenÃ¼z haber bulunmamaktadÄ±r.</p>
}

// ğŸ“Œ Controllers/NewsController.cs - Adminlerin haber ekleyebildiÄŸi Controller
// ğŸ“Œ Haber ekleme iÅŸlemi doÄŸrulandÄ±ktan sonra veritabanÄ±na kaydedilir.
[Authorize(Roles = "Admin")] // âœ… Sadece Admin eriÅŸebilir
public IActionResult AddNews()
{
    return View();
}

[HttpPost]
[Authorize(Roles = "Admin")] // âœ… Sadece Admin ekleyebilir
public IActionResult AddNews(News newNews)
{
    if (ModelState.IsValid)
    {
        _context.News.Add(newNews);
        _context.SaveChanges();
        return RedirectToAction("Index"); // âœ… Ana sayfaya yÃ¶nlendir
    }
    return View(newNews);
}

// ğŸ“Œ Views/News/AddNews.cshtml - Admin panelinde haber ekleme formu
<!-- ğŸ“Œ Yeni haber ekleme formu. -->
<!-- ğŸ“Œ Adminler, baÅŸlÄ±k ve iÃ§erik girerek haber ekleyebilir. -->
<form method="post" asp-action="AddNews">
    <div class="mb-3">
        <label for="Title" class="form-label">BaÅŸlÄ±k</label>
        <input type="text" class="form-control" id="Title" name="Title" required />
    </div>
    <div class="mb-3">
        <label for="Content" class="form-label">Ä°Ã§erik</label>
        <textarea class="form-control" id="Content" name="Content" required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Haber Ekle</button>
</form>


// ğŸ“Œ Models/User.cs - KullanÄ±cÄ± Modeli (VeritabanÄ± tablosu)
// ğŸ“Œ KullanÄ±cÄ± bilgilerini tutar ve maaÅŸ hesaplamasÄ± iÃ§in saatlik Ã¼cret eklenmiÅŸtir.
public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string Surname { get; set; }
    public string TC { get; set; }
    public string Phone { get; set; }
    public int UnitId { get; set; }
    public int RoleId { get; set; }
    public decimal HourlyRate { get; set; } // âœ… KullanÄ±cÄ±nÄ±n saatlik maaÅŸÄ±
}

// ğŸ“Œ Controllers/QRController.cs - KullanÄ±cÄ±nÄ±n Ã§alÄ±ÅŸma sÃ¼relerinden maaÅŸ hesaplama
// ğŸ“Œ KullanÄ±cÄ±nÄ±n QR giriÅŸ Ã§Ä±kÄ±ÅŸ loglarÄ±na bakarak maaÅŸ hesaplar.
public decimal CalculateSalary(int userId)
{
    var logs = _context.QrLogs
        .Where(log => log.UserId == userId && log.GecenSure.HasValue) // âœ… KullanÄ±cÄ±nÄ±n Ã§alÄ±ÅŸma sÃ¼relerini al
        .ToList();

    var totalWorkedHours = logs.Sum(log => log.GecenSure.Value.TotalHours); // âœ… Toplam Ã§alÄ±ÅŸma saatini hesapla
    var user = _context.Users.FirstOrDefault(u => u.Id == userId); // âœ… KullanÄ±cÄ±nÄ±n saatlik Ã¼cretini al

    if (user == null) return 0; // KullanÄ±cÄ± bulunamazsa maaÅŸ hesaplanamaz

    return totalWorkedHours * user.HourlyRate; // âœ… Toplam saat * saatlik Ã¼cret
}

// ğŸ“Œ Controllers/ProfileController.cs - KullanÄ±cÄ±nÄ±n maaÅŸ bilgisini profilde gÃ¶sterme
// ğŸ“Œ KullanÄ±cÄ±nÄ±n maaÅŸÄ±nÄ± hesaplar ve ViewBag Ã¼zerinden sayfaya gÃ¶nderir.
public IActionResult Salary()
{
    var userId = User.FindFirst("UserId")?.Value;
    if (userId == null) return Unauthorized(); // KullanÄ±cÄ± oturum aÃ§mamÄ±ÅŸsa izin verme

    var salary = CalculateSalary(int.Parse(userId)); // âœ… MaaÅŸÄ± hesapla
    ViewBag.Salary = salary;
    return View();
}

// ğŸ“Œ Views/Profile/Profile.cshtml - KullanÄ±cÄ±nÄ±n profil sayfasÄ±na maaÅŸ bilgisi ekleme
<!-- ğŸ“Œ KullanÄ±cÄ±nÄ±n maaÅŸ bilgisini profilinde gÃ¶rÃ¼ntÃ¼ler. -->
<!-- ğŸ“Œ MaaÅŸ hesaplanarak TL cinsinden gÃ¶sterilir. -->
<div class="info-item p-3 bg-light rounded shadow-sm">
    <p class="text-muted mb-1 small">
        <i class="fas fa-dollar-sign me-1"></i> MaaÅŸ
    </p>
    <p class="fw-bold mb-0 fs-5">@ViewBag.Salary.ToString("N2") â‚º</p> <!-- âœ… MaaÅŸ bilgisi TL cinsinden gÃ¶sterilir -->
</div>

// ğŸ“Œ Controllers/AdminController.cs - Admin panelinde toplu maaÅŸ raporu gÃ¶rÃ¼ntÃ¼leme
// ğŸ“Œ Adminler tÃ¼m Ã§alÄ±ÅŸanlarÄ±n maaÅŸlarÄ±nÄ± gÃ¶rebilir.
[Authorize(Roles = "Admin")] // âœ… Sadece Admin eriÅŸebilir
public IActionResult SalaryReport()
{
    var salaries = _context.Users.Select(user => new
    {
        user.Name,
        user.Surname,
        TotalSalary = CalculateSalary(user.Id)
    }).ToList();

    ViewBag.Salaries = salaries;
    return View();
}

// ğŸ“Œ Views/Admin/SalaryReport.cshtml - Admin panelinde toplu maaÅŸ raporu gÃ¶rÃ¼ntÃ¼leme
<!-- ğŸ“Œ Adminlerin Ã§alÄ±ÅŸanlarÄ±n maaÅŸlarÄ±nÄ± toplu olarak gÃ¶rebilmesini saÄŸlar. -->
<h2 class="mb-4">MaaÅŸ Raporu</h2>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Ad Soyad</th>
            <th>Toplam MaaÅŸ</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var salary in ViewBag.Salaries)
        {
            <tr>
                <td>@salary.Name @salary.Surname</td>
                <td>@salary.TotalSalary.ToString("N2") â‚º</td>
            </tr>
        }
    </tbody>
</table>
